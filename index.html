<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ChatGPT Apps — Interactive Category × Capability Matrix</title>
  <style>
    
    :root {
      --bg:#f6f7fb;
      --panel:#ffffff;
      --panel2:#f1f3f9;
      --text:#0f172a;
      --muted:#475569;
      --border:rgba(15,23,42,.12);
      --shadow: 0 18px 45px rgba(15,23,42,.12);
      --chip: rgba(15,23,42,.06);
      --chipHover: rgba(15,23,42,.12);
      --accent:#2563eb;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 15% 8%, rgba(37,99,235,.08), transparent 55%),
        radial-gradient(900px 700px at 92% 18%, rgba(14,165,233,.08), transparent 55%),
        var(--bg);
    }
    header{max-width:1240px;margin:0 auto;padding:22px 16px 8px}
    h1{margin:0 0 6px;font-size:20px;letter-spacing:.2px}
    .sub{margin:0;color:var(--muted);font-size:13px;line-height:1.45}
    .toolbar{
      max-width:1240px;margin:10px auto 0;padding:0 16px 14px;
      display:flex;flex-wrap:wrap;gap:10px;align-items:center;
    }
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,1), rgba(241,243,249,1));
      border:1px solid var(--border);
      border-radius:14px;
      padding:10px 12px;
      display:flex;align-items:center;gap:10px;
      backdrop-filter: blur(6px);
      box-shadow: 0 8px 28px rgba(0,0,0,.18);
    }
    label{font-size:12px;color:var(--muted);white-space:nowrap}
    input[type="search"], select{
      background: var(--panel);
      border:1px solid var(--border);
      color:var(--text);
      padding:9px 10px;
      border-radius:10px;
      outline:none;
      font-size:13px;
    }
    input[type="search"]{width:min(360px, 78vw)}
    button{
      background: var(--panel);
      border:1px solid var(--border);
      color:var(--text);
      padding:9px 10px;
      border-radius:10px;
      font-size:13px;
      cursor:pointer;
    }
    button:hover{border-color:rgba(255,255,255,.25)}
    .pill{
      display:flex; align-items:center; gap:8px;
      padding:8px 10px; border-radius:999px;
      border:1px solid var(--border);
      background: var(--panel2);
      font-size:13px; color:var(--muted);
    }
    .pill input{accent-color: var(--accent)}
    main{max-width:1240px;margin:0 auto;padding:0 16px 26px}
    .wrap{
      border:1px solid var(--border);
      border-radius:16px;
      overflow:hidden;
      background:rgba(0,0,0,.16);
      box-shadow: var(--shadow);
    }
    table{width:100%;border-collapse:separate;border-spacing:0}
    thead th{
      position:sticky;top:0;z-index:4;
      background:linear-gradient(180deg, #ffffff, #f1f3f9);
      border-bottom:1px solid var(--border);
      padding:12px 10px;text-align:left;
      font-size:12px;color:var(--muted);white-space:nowrap;
    }
    thead th:first-child{left:0;z-index:5;position:sticky}
    tbody th{
      position:sticky;left:0;z-index:3;
      background:linear-gradient(180deg, #ffffff, #f1f3f9);
      border-right:1px solid var(--border);
      padding:12px 10px;
      font-size:12px;color:var(--muted);white-space:nowrap;min-width:170px;
    }
    td{
      border-right:1px solid var(--border);
      border-bottom:1px solid var(--border);
      padding:10px;vertical-align:top;min-width:200px;
      background:rgba(255,255,255,.02);
      transition: background 120ms ease;
    }
    tr:last-child td, tr:last-child th{border-bottom:none}
    td:last-child, th:last-child{border-right:none}
    .cellTop{display:flex;justify-content:space-between;align-items:center;gap:10px;margin-bottom:8px}
    .hdrCount{font-size:11px;color:var(--muted);padding:2px 8px;border:1px solid var(--border);border-radius:999px;background:rgba(0,0,0,.04);white-space:nowrap;}
.hdrCount strong{color:var(--text);font-weight:600;}
.count{
      font-size:11px;color:var(--muted);
      padding:2px 8px;border:1px solid var(--border);
      border-radius:999px;background: var(--panel2);white-space:nowrap;
    }
    .legendDot{width:8px;height:8px;border-radius:999px;display:inline-block;margin-right:6px;flex:none}
    .chips{display:flex;flex-wrap:wrap;gap:6px}
    .chip{
      display:inline-flex;align-items:center;gap:6px;
      padding:5px 8px;border-radius:999px;
      border:1px solid var(--border);
      background:var(--chip);
      font-size:12px;cursor:pointer;user-select:none;
    }
    .chip:hover{background:var(--chipHover)}
    .chip.hide{display:none}
    .empty{color:rgba(233,237,255,.45);font-size:12px}
    .footer{
      margin-top:10px;color:var(--muted);font-size:12px;
      display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;
    }
    dialog{
      width:min(720px, 94vw);
      border:none;border-radius:16px;padding:0;
      background: var(--panel);
      color:var(--text);
      box-shadow: 0 20px 60px rgba(15,23,42,.18);
    }
    dialog::backdrop{background: rgba(15,23,42,.25); backdrop-filter: blur(3px)}
    .modalHead{padding:14px 16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;gap:10px}
    .modalHead h2{margin:0;font-size:16px}
    .modalBody{padding:14px 16px 16px}
    .kv{display:grid;grid-template-columns:120px 1fr;gap:8px 12px;font-size:13px;line-height:1.45}
    .k{color:var(--muted)}
    .hint{margin-top:10px;font-size:12px;color:var(--muted)}
  
    .scroll{
      overflow:auto;
      max-width:100%;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
    }
    /* Ensure there is always something to scroll horizontally when needed */
    table{ min-width: 1100px; }

  </style>
</head>
<body>
<header>
  <h1>ChatGPT Apps — Interactive Category × Capability Matrix</h1>
  <p class="sub">This view is generated directly from the base table the agent created (App, Category, Capabilities). Columns = Categories • Rows = Capabilities • Cells = Apps. Search/filter, click chips for details, and use the heatmap shading.</p>
</header>

<section class="toolbar">
  <div class="card">
    <label for="q">Search apps</label>
    <input id="q" type="search" placeholder="Type to filter (e.g., Drive, Zoho, Adobe)…" />
  </div>

  <div class="card">
    <label for="capFilter">Capability row</label>
    <select id="capFilter"><option value="__all__">All</option></select>
  </div>

  <div class="card">
    <label for="catFilter">Category column</label>
    <select id="catFilter"><option value="__all__">All</option></select>
  </div>

  <div class="pill">
    <input id="hideEmpty" type="checkbox" checked />
    <label for="hideEmpty">Hide empty cells</label>
  </div>

  <button id="exportBtn" type="button">Export visible apps (CSV)</button>
  <button id="resetBtn" type="button">Reset</button>
</section>

<main>
  <div class="wrap">
    <div class="scroll" role="region" aria-label="Scrollable table" tabindex="0">
    <table id="matrix" aria-label="Apps capability-category matrix">
      <thead>
        <tr id="headRow">
          <th>Capability</th>
        </tr>
      </thead>
      <tbody id="bodyRows"></tbody>
    </table>
    </div>
  </div>

  <div class="footer">
    <div id="summary"></div>
    <div>Tip: darker cells = more (visible) apps in that cell.</div>
  </div>
</main>

<dialog id="modal">
  <div class="modalHead">
    <h2 id="modalTitle">App</h2>
    <button id="closeModal" type="button">Close</button>
  </div>
  <div class="modalBody">
    <div class="kv">
      <div class="k">Category</div><div id="modalCategory"></div>
      <div class="k">Capabilities</div><div id="modalCaps"></div>
      <div class="k">Description</div><div id="modalDesc"></div>
    </div>
    <div class="hint">“None” means the app detail page didn’t list a capabilities row.</div>
  </div>
</dialog>

<script>
  const DATA = {"apps": [{"name": "Adobe Photoshop", "category": "Design", "capabilities": ["Interactive"], "description": "Adobe Photoshop for ChatGPT simplifies photo editing for creators of any skill level, for free. Upload an image and easily remove the background, refine lighting and color or apply creative effects like motion blur, duotone and glitch. Intuitive controls let you adjust visuals to match your style while delivering high‑quality results. With one click, continue edits in Photoshop on the web or mobile. It’s ideal for profile photos, social posts or any image that needs quick, high‑quality enhancement."}, {"name": "Airtable", "category": "Productivity", "capabilities": ["Interactive", "Writes"], "description": "Bring your operational data and context into ChatGPT conversations to help you get tasks done faster. Use your Airtable data as input to tasks (for example, building a landing page) and quickly update tasks or fields across records without leaving the chat."}, {"name": "Apple Music", "category": "Entertainment", "capabilities": ["Interactive", "Writes"], "description": "Apple Music subscribers can ask ChatGPT to create playlists or find songs, albums and artists using natural language. ChatGPT handles finding the songs and adding them to a playlist rather than requiring manual searches."}, {"name": "Canva", "category": "Design", "capabilities": ["File Search", "Interactive", "Writes"], "description": "Kick‑start the design process from chat. Ask Canva to create social posts, presentations, marketing materials or other visual assets based on your conversation; then continue editing in chat. You can resize designs for different channels, translate them into another language and open the design in Canva’s editor for final touches."}, {"name": "Figma", "category": "Design", "capabilities": ["Interactive", "Writes"], "description": "The Figma app in ChatGPT generates beautifully designed assets, presentations and diagrams. Use it to turn conversations into social posts, digital ads, marketing assets and polished slide decks. It can also create flow charts, Gantt charts and other diagrams in FigJam; anything you create can be moved to Figma for editing, sharing and collaboration."}, {"name": "OpenTable", "category": "Food", "capabilities": ["Interactive"], "description": "Every great meal starts with OpenTable. Discover and book the perfect table from over 60 000 restaurants worldwide—whether you’re planning ahead or booking last minute. Choose with confidence by sharing preferences for cuisine, price, ambiance and more to access personalized recommendations."}, {"name": "Booking.com", "category": "Travel", "capabilities": ["Interactive"], "description": "Millions of stays at your fingertips. From chic city hotels to cozy vacation rentals, the Booking.com app helps you find exactly what you’re looking for. Ask for specific property types, prices and amenities and receive lists of suitable hotels along with prices, photos, reviews and more. Tap “View on Booking.com” to see details and book your stay."}, {"name": "Expedia", "category": "Travel", "capabilities": ["Interactive"], "description": "Bring your trip plans to life – get there, stay there and find things to see and do. The Expedia app allows you to use ChatGPT to ask about lodging, flights and activities and receive curated recommendations."}, {"name": "Lovable", "category": "Developer Tools", "capabilities": ["Interactive", "Writes"], "description": "Lovable is an AI software‑creation platform designed for people with no technical experience. It empowers anyone to turn their ideas into fully functional apps and websites in minutes—just describe what you want and Lovable builds and iterates with you like a world‑class engineer."}, {"name": "Replit", "category": "Developer Tools", "capabilities": ["Interactive", "Writes"], "description": "The Replit app lets you build real web or mobile apps simply by describing what you want in ChatGPT. Tell it your idea and the Replit Agent writes the code, sets everything up and shows a live version. You can continue improving the app by chatting—Replit handles building and updating while you provide input."}, {"name": "Spotify", "category": "Entertainment", "capabilities": ["Interactive", "Writes"], "description": "Connect your Spotify account to ChatGPT and start listening your way. Ask for songs, playlists or podcasts and get personalized recommendations without leaving the chat."}, {"name": "Tripadvisor", "category": "Travel", "capabilities": ["Interactive"], "description": "The Tripadvisor app brings trusted reviews and hotel insights into ChatGPT, offering a faster, more confident way to find the perfect place to stay. Explore top‑rated hotels on an interactive map, refine results through conversational follow‑ups, compare prices and amenities, and click out to booking partners or Tripadvisor for deeper research."}, {"name": "Adobe Acrobat", "category": "Business", "capabilities": ["Interactive", "Writes"], "description": "Adobe Acrobat for ChatGPT lets you transform and organize PDF documents. Edit and merge pages, convert PDFs to Word or images, redact sensitive details and extract text with OCR. You can compress files, split documents and more, making it ideal for students and professionals who manage a lot of PDFs."}, {"name": "Adobe Express", "category": "Design", "capabilities": ["Interactive"], "description": "Create invitations, flyers and social posts quickly. Browse templates, personalize text and images, and when you need deeper controls, open your design in Adobe Express to edit it further."}, {"name": "Aha!", "category": "Productivity", "capabilities": ["File Search", "Sync"], "description": "*No description provided on the app page.*"}, {"name": "Agentforce Sales", "category": "Business", "capabilities": ["Interactive", "Writes"], "description": "Use Salesforce with ChatGPT to get relevant CRM context for deals. Agentforce surfaces data for research, planning and closing faster, and enriches Salesforce with insights so sales teams can streamline their workflow."}, {"name": "Asana", "category": "Productivity", "capabilities": ["File Search", "Sync"], "description": "Work with tasks, subtasks, comments and due dates to create summaries, understand priorities and prepare status updates. The Asana app helps you review upcoming work and activity and turn it into meeting‑ready briefs or progress reports."}, {"name": "Atlassian Rovo", "category": "Collaboration", "capabilities": ["File Search", "Writes"], "description": "The Atlassian Rovo MCP connector gives access to Jira, Confluence and Compass context within ChatGPT so you can summarize work items or pages, dig deeper using reasoning and research, create Jira issues directly and automate multi‑step actions such as generating or updating issues in bulk."}, {"name": "Azure Boards", "category": "Developer Tools", "capabilities": ["File Search", "Sync"], "description": "Connect Azure Boards to sync Azure DevOps work items and repositories for use in ChatGPT—making your development data accessible in conversations."}, {"name": "Basecamp", "category": "Productivity", "capabilities": ["File Search", "Sync"], "description": "The Basecamp app with sync lets ChatGPT securely access your team’s Basecamp projects and message boards as well as to‑dos and to‑do lists to answer questions. Once connected, ChatGPT automatically references Basecamp content when relevant."}, {"name": "Box", "category": "Productivity", "capabilities": ["File Search", "Sync"], "description": "Work with documents, spreadsheets and presentations stored in Box to create concise summaries, pre‑reads or stakeholder updates. Pull details from multiple files, surface key points and draft clear outputs grounded in your team’s existing materials."}, {"name": "Clay", "category": "Business", "capabilities": ["Interactive"], "description": "Prospect with Clay inside ChatGPT: run deep company and contact research without leaving your conversation. Use Clay’s contact databases, enrichment providers and AI agents to research target accounts, surface verified contact info and draft personalized outreach—all through chat."}, {"name": "Conductor", "category": "Business", "capabilities": ["None"], "description": "Analyze your brand’s AI presence and reputation. The Conductor app gives enterprise teams instant access to trusted AI search intelligence. Evaluate brand presence and sentiment, track market share, identify top mentions and citations, and empower marketing, PR and leadership teams to make faster, smarter decisions."}, {"name": "Daloopa", "category": "Finance", "capabilities": ["None"], "description": "Daloopa’s MCP allows best‑in‑class fundamental data to be accessed by large language models. The connector lets LLMs query Daloopa’s vast database and retrieve structured data efficiently, helping clients save time and resources and generate actionable insights rather than incorrect data."}, {"name": "Egnyte", "category": "Collaboration", "capabilities": ["File Search"], "description": "Find and work with files inside ChatGPT with Egnyte’s secure, permission‑based access. Use advanced search to locate files, summarize and manage workflows, download documents and collaborate seamlessly."}, {"name": "GitLab Issues", "category": "Developer Tools", "capabilities": ["File Search", "Sync"], "description": "Connect to sync GitLab issues and merge requests for use in ChatGPT—allowing you to reference and act on your development tasks within the chat."}, {"name": "Google Drive", "category": "Productivity", "capabilities": ["File Search", "Sync"], "description": "Work with your Google Drive documents—including Google Docs, Slides, PDFs and uploaded files—to create summaries, synthesize research, prepare updates or pull context into drafts. Combine information across several files to produce clear, structured content without switching between documents."}, {"name": "Help Scout", "category": "Collaboration", "capabilities": ["File Search", "Sync"], "description": "The Help Scout app with sync lets ChatGPT securely access your team’s Help Scout conversations and threads, customers and mailboxes. Once connected, ChatGPT can reference Help Scout content to answer questions."}, {"name": "Hex", "category": "Business", "capabilities": ["Interactive", "Writes"], "description": "Answer data questions and spin up new analyses with the Hex Agent."}, {"name": "HighLevel", "category": "Business", "capabilities": ["File Search", "Writes"], "description": "HighLevel gives agencies a unified CRM, automation and client‑communication platform. This connector brings HighLevel data—contacts, opportunities, appointments and conversations—into ChatGPT, turning raw records into summaries, next‑step recommendations and ready‑to‑use content. It helps analyze pipelines, qualify leads and prepare follow‑ups without leaving the chat."}, {"name": "HubSpot", "category": "Business", "capabilities": ["File Search", "Sync"], "description": "Work with your HubSpot data to uncover patterns, prepare reports and answer questions about your pipeline or customer base. Explore which deals are closing soon, summarize ticket reasons, understand trends in lost deals or review key details before a meeting."}, {"name": "Hugging Face", "category": "Developer Tools", "capabilities": ["Writes"], "description": "Connect to the Hugging Face Hub to explore models and datasets, access SDK documentation and more. Manage machine‑learning jobs and connect to thousands of AI applications via Spaces."}, {"name": "Jotform", "category": "Productivity", "capabilities": ["Writes"], "description": "Create and edit online forms, then access and analyze submissions directly in ChatGPT. Design forms through natural language, review incoming responses and generate insights or reports without leaving the chat."}, {"name": "Klaviyo", "category": "Business", "capabilities": ["Writes"], "description": "The Klaviyo app provides marketers with a daily pulse on campaign and flow performance within ChatGPT. It surfaces metrics such as sends, open rate, click rate, conversion rate and attributed revenue; offers plain‑language explanations; and lets users dive deeper into campaigns or flows and compare past performance. Marketers can stay informed, identify opportunities and implement updates using natural‑language prompts."}, {"name": "Linear", "category": "Developer Tools", "capabilities": ["File Search", "Sync"], "description": "Use your Linear issues and comments to create clear status updates, identify themes in recent work or understand progress on a feature. Summarize new or resolved issues, review what’s open and prepare team updates grounded in the latest activity."}, {"name": "LSEG", "category": "Finance", "capabilities": ["None"], "description": "Access LSEG’s institutional‑grade financial data and analytics. You can price and analyze bonds, calculate FX forwards and spots, retrieve equity fundamentals and analyst estimates, search global news and earnings transcripts and explore macroeconomic indicators—leveraging the same trusted data that powers global financial markets."}, {"name": "Monday.com", "category": "Productivity", "capabilities": ["Writes"], "description": "This MCP connector enables AI agents to interact with monday.com. It provides comprehensive access to boards, item operations, dashboards and more, allowing AI assistants to manage projects, gain insights and automate workflows within monday.com."}, {"name": "Netlify", "category": "Developer Tools", "capabilities": ["Writes"], "description": "The Netlify app empowers AI agents to autonomously build, deploy and manage web projects through natural‑language commands. It connects ChatGPT to the Netlify platform to automate deployments, manage environment variables, handle form submissions and streamline development workflows."}, {"name": "Notion", "category": "Productivity", "capabilities": ["File Search", "Sync"], "description": "Search and reference your Notion pages within ChatGPT."}, {"name": "Outlook Calendar", "category": "Productivity", "capabilities": ["None"], "description": "Review your Outlook email threads and calendar events to prepare for calls, revisit past conversations, surface upcoming meetings or pull out action items. Use your communication and schedule history to create talking points, clarify follow‑ups and stay organized."}, {"name": "Outlook Email", "category": "Productivity", "capabilities": ["None"], "description": "Review your Outlook email threads and calendar events to prepare for calls, revisit past conversations, surface upcoming meetings or pull out action items. Use your communication and schedule history to create talking points, clarify follow‑ups and stay organized."}, {"name": "Pipedrive", "category": "Business", "capabilities": ["File Search", "Sync"], "description": "The Pipedrive app with sync lets ChatGPT securely access your team’s Pipedrive CRM data—such as deals, contacts and activities—to help answer questions, generate summaries and draft updates."}, {"name": "PitchBook", "category": "Finance", "capabilities": ["None"], "description": "PitchBook provides structured access to private capital‑market data across companies, investors, funds, deals, limited partners and people. It returns normalized fields like firmographics, financing rounds, deal terms, ownership information, financials and fund performance metrics. Use it for factual information on private companies, investment activity or market participants, including summarizing activity or assembling datasets for analysis."}, {"name": "SharePoint", "category": "Productivity", "capabilities": ["File Search", "Sync"], "description": "Work with documents stored in SharePoint or OneDrive—including PDFs, Word, PowerPoint and Excel files—to create onboarding guides, prepare pre‑reads, summarize complex materials or extract key points for stakeholders. Combine content across files to produce clear outputs grounded in your organization’s knowledge."}, {"name": "Slack", "category": "Productivity", "capabilities": ["File Search", "Sync"], "description": "Use your Slack messages and channel discussions to create recaps, gather background before a meeting, highlight decisions or draft responses with the right context. Summarize long threads, review message history and consolidate updates shared across multiple channels."}, {"name": "Stripe", "category": "Finance", "capabilities": ["File Search", "Writes"], "description": "Manage your business and develop your payments integration."}, {"name": "Teams", "category": "Productivity", "capabilities": ["File Search", "Sync"], "description": "Look up chats and messages within Microsoft Teams using ChatGPT."}, {"name": "Teamwork.com", "category": "Productivity", "capabilities": ["File Search", "Sync"], "description": "The Teamwork.com app with sync lets ChatGPT securely access your team’s projects, milestones, tasks and subtasks to answer questions. Once enabled, ChatGPT automatically references Teamwork.com content when relevant."}, {"name": "Vercel", "category": "Developer Tools", "capabilities": ["Writes"], "description": "Vercel’s MCP brings your projects, deployments and documentation directly into ChatGPT. Use natural language to inspect deployments, debug build logs, configure deployment protection settings, brainstorm domains and check real‑time availability and pricing, and query up‑to‑date docs—all without leaving chat."}, {"name": "Zoho", "category": "Business", "capabilities": ["File Search", "Sync"], "description": "Connect to sync Zoho CRM records and activities for use in ChatGPT."}, {"name": "Zoho Desk", "category": "Collaboration", "capabilities": ["File Search", "Sync"], "description": "The Zoho Desk app with sync lets ChatGPT securely access your team’s Zoho Desk tickets and threads, contacts and accounts to answer questions. Once connected, ChatGPT automatically references Zoho Desk content when helpful."}, {"name": "Zoom", "category": "Collaboration", "capabilities": ["Interactive", "Writes"], "description": "Bring Zoom’s meeting intelligence, powered by Zoom AI Companion, into ChatGPT. Instantly access post‑meeting assets including summaries, recordings, documents and whiteboards. Ask questions and get precise moments from recordings with an embedded player that jumps to the exact discussion point. Make meetings searchable, actionable and seamlessly integrated into AI workflows."}], "categories": ["Business", "Collaboration", "Design", "Developer Tools", "Entertainment", "Finance", "Food", "Productivity", "Travel"], "capabilities": ["Interactive", "Writes", "File Search", "Sync", "None"]};

  const apps = DATA.apps;
  const categories = DATA.categories;
  const capsOrder = DATA.capabilities;

  const palette = ["#7aa2ff","#2dd4bf","#fbbf24","#f472b6","#a78bfa","#fb7185","#34d399","#60a5fa","#f97316","#22c55e"];
  const catColor = {};
  categories.forEach((c,i)=>catColor[c]=palette[i % palette.length]);

  const q = document.getElementById("q");
  const capFilter = document.getElementById("capFilter");
  const catFilter = document.getElementById("catFilter");
  const hideEmpty = document.getElementById("hideEmpty");
  const resetBtn = document.getElementById("resetBtn");
  const exportBtn = document.getElementById("exportBtn");

  const headRow = document.getElementById("headRow");
  const bodyRows = document.getElementById("bodyRows");
  const summary = document.getElementById("summary");

  const modal = document.getElementById("modal");
  const modalTitle = document.getElementById("modalTitle");
  const modalCategory = document.getElementById("modalCategory");
  const modalCaps = document.getElementById("modalCaps");
  const modalDesc = document.getElementById("modalDesc");
  const closeModal = document.getElementById("closeModal");

  function normalize(s){ return (s || "").toLowerCase().trim(); }

  function buildSelectOptions(select, items){
    items.forEach(it=>{
      const opt = document.createElement("option");
      opt.value = it;
      opt.textContent = (it === "None") ? "No capabilities listed" : it;
      select.appendChild(opt);
    });
  }

  function appsInCell(capability, category){
    return apps
      .filter(a => a.category === category && (a.capabilities || []).includes(capability))
      .map(a => a.name)
      .sort((a,b)=>a.localeCompare(b));
  }

  function buildMatrix(){
    categories.forEach(cat=>{
      const th = document.createElement("th");
      th.dataset.cat = cat;
      th.innerHTML = '<span class="legendDot" style="background:'+catColor[cat]+'"></span>'+cat+' <span class="hdrCount" data-colcount="'+cat+'"><strong>0</strong></span>';
      headRow.appendChild(th);
    });

    capsOrder.forEach(cap=>{
      const tr = document.createElement("tr");
      tr.dataset.cap = cap;

      const th = document.createElement("th");
      th.innerHTML = ((cap === "None") ? "No capabilities listed" : cap) + ' <span class="hdrCount" data-rowcount="'+cap+'"><strong>0</strong></span>';
      tr.appendChild(th);

      categories.forEach(cat=>{
        const td = document.createElement("td");
        td.dataset.cat = cat;
        td.dataset.cap = cap;

        const list = appsInCell(cap, cat);
        if (list.length === 0){
          const empty = document.createElement("div");
          empty.className = "empty";
          empty.textContent = "—";
          td.appendChild(empty);
        } else {
          const top = document.createElement("div");
          top.className = "cellTop";
          const count = document.createElement("div");
          count.className = "count";
          count.textContent = list.length + " app" + (list.length===1?"":"s");
          top.appendChild(count);
          td.appendChild(top);

          const chips = document.createElement("div");
          chips.className = "chips";

          list.forEach(name=>{
            const chip = document.createElement("span");
            chip.className = "chip";
            chip.dataset.app = name;
            chip.innerHTML = '<span class="legendDot" style="background:'+catColor[cat]+'"></span>'+name;
            chip.addEventListener("click", ()=>openModal(name));
            chips.appendChild(chip);
          });

          td.appendChild(chips);
        }

        tr.appendChild(td);
      });

      bodyRows.appendChild(tr);
    });
  }

  function openModal(appName){
    const app = apps.find(a=>a.name===appName);
    if (!app) return;
    modalTitle.textContent = app.name;
    modalCategory.textContent = app.category;
    const caps = (app.capabilities || []).slice().sort((a,b)=>a.localeCompare(b));
    modalCaps.textContent = caps.includes("None") ? "None listed in directory" : caps.join(", ");
    modalDesc.textContent = app.description || "Description not available.";
    modal.showModal();
  }

  function applyFilters(){
    const query = normalize(q.value);
    const capSel = capFilter.value;
    const catSel = catFilter.value;
    const hide = hideEmpty.checked;

    document.querySelectorAll("thead th[data-cat]").forEach(th=>{
      const show = (catSel === "__all__" || th.dataset.cat === catSel);
      th.style.display = show ? "" : "none";
    });

    let visibleApps = 0;
    let visibleCells = 0;
    let maxCellCount = 0;

    const rows = Array.from(bodyRows.querySelectorAll("tr"));

    // max per cell for heatmap
    for (const tr of rows){
      const cap = tr.dataset.cap;
      if (!(capSel === "__all__" || capSel === cap)) continue;
      for (const td of tr.querySelectorAll("td")){
        const cat = td.dataset.cat;
        if (!(catSel === "__all__" || catSel === cat)) continue;
        const chips = Array.from(td.querySelectorAll(".chip"));
        let cnt = 0;
        for (const chip of chips){
          if (normalize(chip.dataset.app).includes(query)) cnt++;
        }
        if (cnt > maxCellCount) maxCellCount = cnt;
      }
    }
    if (maxCellCount === 0) maxCellCount = 1;

    for (const tr of rows){
      const cap = tr.dataset.cap;
      const rowAllowed = (capSel === "__all__" || capSel === cap);
      tr.style.display = rowAllowed ? "" : "none";
      if (!rowAllowed) continue;

      for (const td of tr.querySelectorAll("td")){
        const cat = td.dataset.cat;
        const cellAllowed = (catSel === "__all__" || catSel === cat);
        td.style.display = cellAllowed ? "" : "none";
        if (!cellAllowed) continue;

        const chips = Array.from(td.querySelectorAll(".chip"));
        let anyVisible = false;
        let cnt = 0;

        for (const chip of chips){
          const ok = normalize(chip.dataset.app).includes(query);
          chip.classList.toggle("hide", !ok);
          if (ok){ anyVisible = true; cnt++; visibleApps++; }
        }

        const intensity = Math.min(0.36, 0.05 + (0.31 * (cnt / maxCellCount)));
        td.style.background = "rgba(255,255,255,"+intensity+")";

        const badge = td.querySelector(".count");
        if (badge) badge.textContent = cnt + " app" + (cnt===1?"":"s");

        const isEmptyOriginally = chips.length === 0;
        const shouldHideCell = hide && (isEmptyOriginally || !anyVisible);

        td.style.visibility = shouldHideCell ? "hidden" : "visible";
        td.style.padding = shouldHideCell ? "0px" : "10px";
        td.style.borderBottomColor = shouldHideCell ? "transparent" : "";
        if (!shouldHideCell) visibleCells++;
      }
    }

    
    // Row & column unique app counts (no double counting)
    const rowSets = new Map();  // cap -> Set(appName)
    const colSets = new Map();  // cat -> Set(appName)
    categories.forEach(c=>colSets.set(c, new Set()));

    const visibleRows = Array.from(bodyRows.querySelectorAll("tr"))
      .filter(tr => tr.style.display !== "none");

    for (const tr of visibleRows){
      const cap = tr.dataset.cap;
      if (!rowSets.has(cap)) rowSets.set(cap, new Set());
      const cells = Array.from(tr.querySelectorAll("td"))
        .filter(td => td.style.display !== "none" && td.style.visibility !== "hidden");
      for (const td of cells){
        const cat = td.dataset.cat;
        const chips = Array.from(td.querySelectorAll(".chip"))
          .filter(chip => !chip.classList.contains("hide"));
        for (const chip of chips){
          const name = chip.dataset.app;
          rowSets.get(cap).add(name);
          if (colSets.has(cat)) colSets.get(cat).add(name);
        }
      }
    }

    // Update row count badges
    for (const [cap, setv] of rowSets.entries()){
      const el = document.querySelector('[data-rowcount="'+cap+'"] strong');
      if (el) el.textContent = setv.size;
    }
    // Rows that are hidden should show 0
    capsOrder.forEach(cap=>{
      const tr = bodyRows.querySelector('tr[data-cap="'+cap+'"]');
      const el = document.querySelector('[data-rowcount="'+cap+'"] strong');
      if (el && tr && tr.style.display === "none") el.textContent = 0;
    });

    // Update column count badges
    for (const cat of categories){
      const hdr = document.querySelector('[data-colcount="'+cat+'"]');
      if (!hdr) continue;
      const strong = hdr.querySelector("strong");
      const th = document.querySelector('thead th[data-cat="'+cat+'"]');
      const shown = !th || th.style.display !== "none";
      strong.textContent = shown ? (colSets.get(cat)?.size || 0) : 0;
    }

    summary.textContent = "Showing " + visibleApps + " matching apps across " + visibleCells + " visible cells.";
  }

  function exportVisibleCSV(){
    const query = normalize(q.value);
    const capSel = capFilter.value;
    const catSel = catFilter.value;

    const visible = [];
    for (const app of apps){
      if (catSel !== "__all__" && app.category !== catSel) continue;
      if (!normalize(app.name).includes(query)) continue;
      if (capSel !== "__all__" && !(app.capabilities || []).includes(capSel)) continue;
      visible.push(app);
    }

    const lines = ["App,Category,Capabilities"];
    for (const a of visible){
      const caps = (a.capabilities || []).join("; ");
      const capsEsc = '"' + caps.replaceAll('"','""') + '"';
      lines.push([a.name, a.category, capsEsc].join(","));
    }

    const blob = new Blob([lines.join("\n")], {type:"text/csv;charset=utf-8"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "chatgpt_apps_visible.csv";
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  function resetAll(){
    q.value = "";
    capFilter.value = "__all__";
    catFilter.value = "__all__";
    hideEmpty.checked = true;
    applyFilters();
  }

  buildSelectOptions(capFilter, capsOrder);
  buildSelectOptions(catFilter, categories);
  buildMatrix();
  applyFilters();

  q.addEventListener("input", applyFilters);
  capFilter.addEventListener("change", applyFilters);
  catFilter.addEventListener("change", applyFilters);
  hideEmpty.addEventListener("change", applyFilters);
  resetBtn.addEventListener("click", resetAll);
  exportBtn.addEventListener("click", exportVisibleCSV);

  closeModal.addEventListener("click", ()=>modal.close());
  modal.addEventListener("click", (e)=>{
    const rect = modal.getBoundingClientRect();
    const inside = e.clientX>=rect.left && e.clientX<=rect.right && e.clientY>=rect.top && e.clientY<=rect.bottom;
    if (!inside) modal.close();
  });
  document.addEventListener("keydown", (e)=>{ if (e.key==="Escape" && modal.open) modal.close(); });
</script>
</body>
</html>
